<div class="post-card">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞ -->
  <div class="post-header">
    <h2 class="post-title">{{ post.title }}</h2>
    <div class="post-meta">
      <span class="author">{{ post.author }} ({{ post.author_username }})</span>
      <span class="date">{{ formatDate(post.created_at) }}</span>
      <span class="status" [class.published]="post.is_published" [class.draft]="!post.is_published">
        {{ post.is_published ? '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ' : '–ß–µ—Ä–Ω–æ–≤–∏–∫' }}
      </span>
    </div>
  </div>

  <!-- –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ -->
  <div class="post-content">
    <p>{{ post.content }}</p>
  </div>

  <!-- –í–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å—Ç–∞ -->
  <div class="post-attachments" *ngIf="post.attachments?.length">
    <h4>–í–ª–æ–∂–µ–Ω–∏—è:</h4>
    <div class="attachments-grid">
      <div *ngFor="let attachment of post.attachments">
        <!-- –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é -->
        @if (attachment.file_type==="image") {
          <div class="image-preview-container">
            <img
              ngSrc="{{attachment.file_url}}"
              [alt]="'–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'"
              class="thumbnail-image"
              (click)="openImagePreview($event, attachment.file_url)"
              width="320"
              height="320"
              style="width: auto; height: auto; max-width: 100%; max-height: 150px;"
            >
          </div>
        } @else {

        <!-- –î–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ -->
        <div class="attachment-item">
          <a
            [href]="attachment.image_url"
            target="_blank"
            class="attachment-link">
            –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
          </a>
        </div>
        }


      </div>
    </div>
  </div>

  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö -->
  <div class="post-stats">
    <span class="comments-count">
      üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: {{ post.comments_count }}
    </span>
    <span class="updated-date" *ngIf="post.updated_at !== post.created_at">
      –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ formatDate(post.updated_at) }}
    </span>
  </div>

  <!-- –°–µ–∫—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
  <div class="comments-section">
    <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <div class="loading-state" *ngIf="isLoadingComments">
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤...</p>
    </div>

    <!-- –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="error-state" *ngIf="errorMessage">
      <p class="error-message">{{ errorMessage }}</p>
      <button class="retry-button" (click)="loadTopLevelComments()">
        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
      </button>
    </div>

    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
    <div class="comments-container" *ngIf="isCommentsLoaded && !isLoadingComments">
      <app-comment-thread
        [comments]="topLevelComments"
        [postId]="post.id">
      </app-comment-thread>
    </div>

    <!-- –ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <div class="no-comments" *ngIf="isCommentsLoaded && topLevelComments.length === 0">
      <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ —ç—Ç–æ–º—É –ø–æ—Å—Ç—É</p>
      <button class="add-comment-button" (click)="showCommentForm = true">
        –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
      </button>
      <app-add-comment
        *ngIf="showCommentForm"
        [postId]="post.id"
        (commentAdded)="onCommentAdded()">
      </app-add-comment>
    </div>
  </div>
</div>

<app-image-preview-modal
  [imageUrl]="previewImageUrl"
  (close)="previewImageUrl = null">
</app-image-preview-modal>
